{
  "description": "RosterPresenter agent tests for roster presentation and user approval flow",
  "test_cases": [
    {
      "name": "present_successful_roster",
      "description": "Agent should present a successful roster and save as draft",
      "input": "present the roster",
      "session_state": {
        "draft_roster": {
          "id": "roster_test_001",
          "period": {"start": "2025-01-06", "end": "2025-01-12"},
          "assignments": [
            {"nurse_id": "nurse_001", "shift_id": "shift_001"},
            {"nurse_id": "nurse_002", "shift_id": "shift_002"}
          ]
        },
        "compliance_report": "COMPLIANCE REPORT\nStatus: PASS",
        "empathy_report": "EMPATHY REPORT\nEmpathy Score: 0.85"
      },
      "expected_tool_trajectory": [
        {"tool_name": "save_draft_roster"}
      ],
      "expected_response_contains": ["ROSTER SUMMARY", "roster_test_001", "COMPLIANCE", "EMPATHY"]
    },
    {
      "name": "handle_generation_failure",
      "description": "Agent should present failure analysis when roster generation failed",
      "input": "present the roster",
      "session_state": {
        "draft_roster": {
          "error": "Failed to generate roster",
          "analysis": {
            "capacity_gap": "15 hours short",
            "missing_certifications": ["ICU"]
          }
        }
      },
      "expected_tool_trajectory": [],
      "expected_response_contains": ["FAILED", "CAPACITY", "RECOMMENDATIONS"]
    },
    {
      "name": "approve_roster",
      "description": "Agent should finalize roster when user approves",
      "input": "approve",
      "session_state": {
        "draft_roster": {
          "id": "roster_pending_001",
          "status": "draft"
        }
      },
      "expected_tool_trajectory": [
        {"tool_name": "finalize_roster", "args": {"roster_id": "roster_pending_001"}}
      ],
      "expected_response_contains": ["finalized", "approved"]
    },
    {
      "name": "reject_roster_with_reason",
      "description": "Agent should reject roster with user's reason",
      "input": "reject because there are too many compliance violations",
      "session_state": {
        "draft_roster": {
          "id": "roster_pending_002",
          "status": "draft"
        }
      },
      "expected_tool_trajectory": [
        {"tool_name": "reject_roster", "args": {"roster_id": "roster_pending_002"}}
      ],
      "expected_response_contains": ["rejected", "compliance"]
    },
    {
      "name": "list_pending_rosters",
      "description": "Agent should list pending rosters when asked",
      "input": "show me pending rosters",
      "expected_tool_trajectory": [
        {"tool_name": "list_pending_rosters"}
      ],
      "expected_response_contains": ["roster"]
    },
    {
      "name": "list_all_rosters",
      "description": "Agent should list all rosters when asked",
      "input": "show all rosters",
      "expected_tool_trajectory": [
        {"tool_name": "list_all_rosters"}
      ],
      "expected_response_contains": ["roster"]
    },
    {
      "name": "include_compliance_summary",
      "description": "Agent should include compliance summary in presentation",
      "input": "present the roster summary",
      "session_state": {
        "draft_roster": {
          "id": "roster_test_002",
          "assignments": []
        },
        "compliance_report": "COMPLIANCE REPORT\nStatus: FAIL\nViolations: 2 certification issues"
      },
      "expected_response_contains": ["COMPLIANCE", "FAIL", "violation"]
    },
    {
      "name": "include_empathy_score",
      "description": "Agent should include empathy score in presentation",
      "input": "present the roster summary",
      "session_state": {
        "draft_roster": {
          "id": "roster_test_003",
          "assignments": []
        },
        "empathy_report": "EMPATHY REPORT\nEmpathy Score: 0.65\nConcerns: Weekend distribution unfair"
      },
      "expected_response_contains": ["EMPATHY", "0.65", "weekend"]
    },
    {
      "name": "delete_rejected_roster",
      "description": "Agent should delete a rejected roster when asked",
      "input": "delete roster_rejected_001",
      "expected_tool_trajectory": [
        {"tool_name": "delete_roster", "args": {"roster_id": "roster_rejected_001"}}
      ],
      "expected_response_contains": ["deleted"]
    },
    {
      "name": "idempotent_save",
      "description": "Agent should not save draft multiple times",
      "input": "present the roster again",
      "session_state": {
        "draft_roster": {
          "id": "roster_already_saved",
          "status": "draft",
          "_already_saved": true
        }
      },
      "expected_tool_trajectory": [],
      "expected_response_contains": ["ROSTER SUMMARY", "already", "saved"]
    },
    {
      "name": "highlight_concerns",
      "description": "Agent should highlight concerns from both reports",
      "input": "present the roster and highlight any issues",
      "session_state": {
        "draft_roster": {
          "id": "roster_concerns_001",
          "assignments": []
        },
        "compliance_report": "COMPLIANCE REPORT\nStatus: PASS\nWarning: Close to hour limit",
        "empathy_report": "EMPATHY REPORT\nEmpathy Score: 0.72\nConcern: Alice has high fatigue"
      },
      "expected_response_contains": ["CONCERNS", "hour limit", "fatigue"]
    }
  ]
}
